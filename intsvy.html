<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.6">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>12&nbsp; intsvyを使う – Rで学ぶ大規模学力調査（Version 1.0）</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./pisa_timss.html" rel="next">
<link href="./pvs.html" rel="prev">
<link href="./image/bookcover.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-6c21014d9765ba549c6ebad95917e4d7.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-e78aeb9f0bd9243cf33a09e7acbda6f9.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "一致なし",
    "search-matching-documents-text": "一致した文書",
    "search-copy-link-title": "検索へのリンクをコピー",
    "search-hide-matches-text": "追加の検索結果を非表示",
    "search-more-match-text": "追加の検索結果",
    "search-more-matches-text": "追加の検索結果",
    "search-clear-button-title": "消去",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "取消",
    "search-submit-button-title": "検索",
    "search-label": "サーチ"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-YPY43001RV"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-YPY43001RV', { 'anonymize_ip': true});
</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="style/styles.css">
<meta name="twitter:title" content="12&nbsp; intsvyを使う – Rで学ぶ大規模学力調査（Version 1.0）">
<meta name="twitter:description" content="">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="サイドバーを切り替える" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./intsvy.html">実践編</a></li><li class="breadcrumb-item"><a href="./intsvy.html"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">intsvyを使う</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="サイドバーを切り替える" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="サーチ" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Rで学ぶ大規模学力調査（Version 1.0）</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/kawa5902/RforLSA" title="ソースコード" class="quarto-navigation-tool px-1" aria-label="ソースコード"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="サーチ"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">はじめに</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">導入</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="セクションを切り替え">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro_lsa.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">なぜLSAを学ぶのか</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./r_colab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">R on Colab</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./r_basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Rの基本操作</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sampling_basic1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">標本調査の基礎知識1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sampling_basic2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">標本調査の基礎知識2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dataframe.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">データフレーム</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat_basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">相関係数と回帰分析</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">理論編</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="セクションを切り替え">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sampling_weight.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">標本ウェイト</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./replication.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Replication Method</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./irt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">項目反応理論</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pvs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">推算値法</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">実践編</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="セクションを切り替え">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intsvy.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">intsvyを使う</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pisa_timss.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">PISAとTIMSSの概要</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pisa.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">PISAの分析</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./timss.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">TIMSSの分析</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">補足</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="セクションを切り替え">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_prep.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">LSAのデータを入手する</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">まとめ</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">参考文献</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">目次</h2>
   
  <ul>
  <li><a href="#intsvyのインストール" id="toc-intsvyのインストール" class="nav-link active" data-scroll-target="#intsvyのインストール"><span class="header-section-number">12.1</span> intsvyのインストール</a></li>
  <li><a href="#平均や分散の計算pvを使わない場合" id="toc-平均や分散の計算pvを使わない場合" class="nav-link" data-scroll-target="#平均や分散の計算pvを使わない場合"><span class="header-section-number">12.2</span> 平均や分散の計算（PVを使わない場合）</a></li>
  <li><a href="#平均や分散の計算pvを使う場合" id="toc-平均や分散の計算pvを使う場合" class="nav-link" data-scroll-target="#平均や分散の計算pvを使う場合"><span class="header-section-number">12.3</span> 平均や分散の計算（PVを使う場合）</a></li>
  <li><a href="#回帰分析" id="toc-回帰分析" class="nav-link" data-scroll-target="#回帰分析"><span class="header-section-number">12.4</span> 回帰分析</a></li>
  <li><a href="#相関係数pvを使う場合" id="toc-相関係数pvを使う場合" class="nav-link" data-scroll-target="#相関係数pvを使う場合"><span class="header-section-number">12.5</span> 相関係数（PVを使う場合）</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./intsvy.html">実践編</a></li><li class="breadcrumb-item"><a href="./intsvy.html"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">intsvyを使う</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-intsvy" class="quarto-section-identifier"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">intsvyを使う</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>理論編ではPISAを例に，LSAで一般的に利用されている技術 （標本ウェイト・Replication Method・項目反応理論・推算値法）について 解説してきました。 これらの説明を聞いて面倒だと思った人も多いでしょう。 幸い，こうした処理はPISAやTIMSSを分析するだけならば， それほど大きな壁ではありません。 基本的な分析（平均や相関，あるいは回帰）であれば， Replication MethodsやPVsの統合を自動化してくれるソフトウェアがあるからです。 ここでは，RでPISAやTIMSSといったLSAを分析するためのパッケージである <a href="https://cran.r-project.org/web/packages/intsvy/index.html">intsvy</a>を紹介します。</p>
<section id="intsvyのインストール" class="level2" data-number="12.1">
<h2 data-number="12.1" class="anchored" data-anchor-id="intsvyのインストール"><span class="header-section-number">12.1</span> intsvyのインストール</h2>
<p>以下のコマンドを入力すると， colab上でintsvyが使えるようになります。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R on Colab上でintsvyを使う</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ダウンロード</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">system</span>(<span class="st">"curl -L -o library.tar.gz https://github.com/kawa5902/LSAdata/raw/refs/heads/main/202502library.tar.gz"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 解凍</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">system</span>(<span class="st">"tar -xzf /content/library.tar.gz -C /content"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">.libPaths</span>(<span class="st">"library"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>なお，この方法は一般的なRのパッケージのインストール方法ではありません。 通常のRでは，パッケージを追加する際<code>install.packages</code>関数を使います。 たとえば<code>intsvy</code>をインストールする際は，以下のように行います。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># インストール</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"intsvy"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Colab上でも<code>install.packages</code>関数を利用してパッケージをインストールすることは可能です。 ただColabを終了すると，インストールしたパッケージはすべて消えてしまいます。 そのため再びColabを起動した際は，あらためて<code>install.packages</code>を実行する必要があります。 <code>intsvy</code>のインストールには10分程度必要なので，1〜2回ならともかく 分析のたびに<code>install.packages</code>を実行するのは苦痛です。</p>
<p>そこで本書では，あらかじめColab上にインストールしたパッケージの塊（<code>library.tar.gz</code>）を 別の場所（<a href="https://github.com/kawa5902/LSAdata">github</a>）<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>に保存しておき， それをダウンロードしてきて使うという方法を採用しています。 この方法なら1分弱で<code>intsvy</code>を利用可能になります。 ただし裏技に近い使い方なので，Colab以外では使用しないでください。</p>
</section>
<section id="平均や分散の計算pvを使わない場合" class="level2" data-number="12.2">
<h2 data-number="12.2" class="anchored" data-anchor-id="平均や分散の計算pvを使わない場合"><span class="header-section-number">12.2</span> 平均や分散の計算（PVを使わない場合）</h2>
<p>ここではPISA2012の日本のデータを例に，いくつかintsvyを使った分析をしてみましょう。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># データの読み込み</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/kawa5902/LSAdata/refs/heads/main/pisa2012stuJPN.csv"</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>jpn2012 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(url)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>最初に，ESCSの平均値を計算することを考えましょう。 まず，ESCSは欠測値として9999が設定されているので， 事前にNAに変換しておく必要があります。 続いて<code>pisa.mean</code>関数を使うことで，平均を求めることができます。 この関数は，標本ウェイトやreplication weightを考慮した計算を行ってくれるので， 引数を設定するだけで適切な推定値や標準誤差が算出されます。 なお，本書では<code>pisa.mean</code>関数が<code>intsvy</code>パッケージに含まれていることを明示するため， <code>intsvy::pisa.mean</code>という具合に，関数の前にパッケージ名を示す記法を採用しています。 引数の<code>variable</code>に与えるのは文字なので，ダブルクオーテーション（""）で囲むことを忘れないでください。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 欠測をNAに変換</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>jpn2012<span class="sc">$</span>ESCS[jpn2012<span class="sc">$</span>ESCS <span class="sc">==</span> <span class="dv">9999</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>intsvy<span class="sc">::</span><span class="fu">pisa.mean</span>(<span class="at">variable =</span> <span class="st">"ESCS"</span>, <span class="at">data =</span> jpn2012)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Freq        Mean       s.e.        SD         s.e
1 6185 -0.07151303 0.01524119 0.7036702 0.007597166</code></pre>
</div>
</div>
<p>度数分布は<code>pisa.table</code>関数です。 この関数は度数（Freq）と標本ウェイトを考慮した割合（Percentage）， および割合の標準誤差（Std.err）を算出します。 <code>pisa.mean</code>関数の場合と同じく，<code>intsvy::pisa.table</code>として利用します。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>intsvy<span class="sc">::</span><span class="fu">pisa.table</span>(<span class="at">variable =</span> <span class="st">"ST03Q01"</span>, <span class="at">data =</span> jpn2012)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   ST03Q01 Freq Percentage Std.err.
1        1  521       8.20     0.36
2        2  456       7.27     0.38
3        3  501       7.89     0.38
4        4  532       8.30     0.36
5        5  533       8.43     0.34
6        6  521       8.07     0.30
7        7  574       9.00     0.40
8        8  560       8.94     0.36
9        9  541       8.56     0.43
10      10  547       8.64     0.32
11      11  510       7.98     0.38
12      12  555       8.72     0.38</code></pre>
</div>
</div>
<p>いずれの関数も引数<code>by</code>を設定することで， 下位集団ごとの推定値を得ることが可能です。 引数<code>by</code>に与えるのも文字なので，ダブルクオーテーション（""）で囲んでください。 ここでは， 男女（<code>ST04Q01</code>）別の<code>ESCS</code>の平均値と， 男女（<code>ST04Q01</code>）別の生まれ月（<code>ST03Q01</code>）の度数分布を示しています。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>intsvy<span class="sc">::</span><span class="fu">pisa.mean</span>(<span class="at">variable =</span> <span class="st">"ESCS"</span>, <span class="at">by =</span> <span class="st">"ST04Q01"</span>, <span class="at">data =</span> jpn2012)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ST04Q01 Freq        Mean       s.e.        SD         s.e
1       1 2974 -0.07228828 0.02079859 0.7075644 0.010526624
2       2 3211 -0.07079883 0.01925711 0.7001372 0.008863656</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>intsvy<span class="sc">::</span><span class="fu">pisa.table</span>(<span class="at">variable =</span> <span class="st">"ST03Q01"</span>, <span class="at">by =</span> <span class="st">"ST04Q01"</span>, <span class="at">data =</span> jpn2012)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   ST04Q01 ST03Q01 Freq Percentage Std.err.
1        1       1  263       8.73     0.51
2        1       2  225       7.60     0.51
3        1       3  226       7.48     0.49
4        1       4  249       8.11     0.48
5        1       5  268       9.00     0.49
6        1       6  247       7.97     0.42
7        1       7  263       8.57     0.58
8        1       8  264       8.78     0.49
9        1       9  249       8.40     0.62
10       1      10  275       9.16     0.50
11       1      11  226       7.43     0.47
12       1      12  266       8.76     0.51
13       2       1  258       7.73     0.49
14       2       2  231       6.97     0.46
15       2       3  275       8.25     0.49
16       2       4  283       8.47     0.46
17       2       5  265       7.92     0.48
18       2       6  274       8.15     0.45
19       2       7  311       9.38     0.51
20       2       8  296       9.08     0.50
21       2       9  292       8.70     0.50
22       2      10  272       8.17     0.51
23       2      11  284       8.49     0.49
24       2      12  289       8.69     0.52</code></pre>
</div>
</div>
<p><code>pisa.rho</code>関数を使うと，指定した変数間の相関係数（およびその標準誤差）を算出できます。 ここでは，<code>PV1READ</code>・<code>PV1MATH</code>・<code>ESCS</code>の3つの変数間の相関係数を出力しています。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>intsvy<span class="sc">::</span><span class="fu">pisa.rho</span>(<span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"PV1READ"</span>, <span class="st">"PV1MATH"</span>, <span class="st">"ESCS"</span>), <span class="at">data =</span> jpn2012)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        PV1READ Rho PV1READ s.e. PV1MATH Rho PV1MATH s.e. ESCS Rho ESCS s.e.
PV1READ       1.000        0.000       0.861        0.006    0.289     0.024
PV1MATH       0.861        0.006       1.000        0.000    0.320     0.025
ESCS          0.289        0.024       0.320        0.025    1.000     0.000
attr(,"class")
[1] "intsvy.rho" "matrix"     "array"     </code></pre>
</div>
</div>
</section>
<section id="平均や分散の計算pvを使う場合" class="level2" data-number="12.3">
<h2 data-number="12.3" class="anchored" data-anchor-id="平均や分散の計算pvを使う場合"><span class="header-section-number">12.3</span> 平均や分散の計算（PVを使う場合）</h2>
<p>前の節で取り上げた関数のうち，<code>pisa.mean</code>関数にはPVを考慮した <code>pisa.mean.pv</code>という関数が存在します。 この関数では，読解リテラシーや数学リテラシーの平均値と標準偏差を算出することが可能です。 PVの設定にはやや癖があり，<code>paste0</code>関数を使うことになっています。 また，引数<code>by</code>を設定することで，男女別の平均値などを出力することもできます。 ここでは，数学リテラシー（<code>paste0("PV", 1:5, "MATH")</code>）の平均値の出力と， それをさらに男女（<code>ST04Q01</code>）別に計算する方法を示します。 <code>paste0</code>内の数値（1:5）は，PVの数に対応しています。 PISA2012ではPV1からPV5までが存在するので，<code>paste0("PV", 1:5, "MATH")</code>というわけです。 PISA2015以降ではPVが10個になりますので，<code>paste0("PV", 1:10, "MATH")</code>とします。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>intsvy<span class="sc">::</span><span class="fu">pisa.mean.pv</span>(<span class="at">pvlabel =</span> <span class="fu">paste0</span>(<span class="st">"PV"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="st">"MATH"</span>), <span class="at">data =</span> jpn2012)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Freq   Mean s.e.    SD  s.e
1 6351 536.41 3.59 93.52 2.19</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>intsvy<span class="sc">::</span><span class="fu">pisa.mean.pv</span>(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">pvlabel =</span> <span class="fu">paste0</span>(<span class="st">"PV"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="st">"MATH"</span>), <span class="at">by =</span> <span class="st">"ST04Q01"</span>, <span class="at">data =</span> jpn2012</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ST04Q01 Freq   Mean s.e.    SD  s.e
1       1 3021 527.01 3.59 88.06 2.63
2       2 3330 544.88 4.62 97.41 2.65</code></pre>
</div>
</div>
</section>
<section id="回帰分析" class="level2" data-number="12.4">
<h2 data-number="12.4" class="anchored" data-anchor-id="回帰分析"><span class="header-section-number">12.4</span> 回帰分析</h2>
<p>回帰分析を行う関数として，<code>pisa.reg</code>，<code>pisa.reg.pv</code>関数が用意されています。 前者がPVを使わない場合，後者はPVを使う場合の関数です。 ここでは，<code>PV1READ</code>を従属変数，<code>ESCS</code>を独立変数とした場合の回帰分析の例を示します。 式で言うと，<span class="math inline">\(PV1READ = \beta_0 + \beta_1 ESCS + \epsilon\)</span>という状態です。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>intsvy<span class="sc">::</span><span class="fu">pisa.reg</span>(<span class="at">y =</span> <span class="st">"PV1READ"</span>, <span class="at">x =</span> <span class="st">"ESCS"</span>, <span class="at">data =</span> jpn2012)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            Estimate Std. Error t value
(Intercept)   543.78       3.32  163.92
ESCS           39.24       3.69   10.63
R-squared       0.08       0.01    5.95</code></pre>
</div>
</div>
<p>出力は，<code>Estimate</code>の列が推定値，<code>Std.Err</code>の列が標準誤差を示します。 <code>t value</code>の列やは<code>R-squared</code>の行は気にしなくて構いません<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>。 ここでは，<code>(Intercept)</code>が<span class="math inline">\(\beta_0\)</span>，<code>ESCS</code>が<span class="math inline">\(\beta_1\)</span>に該当しますので， <code>ESCS</code>が1単位上昇すると<code>PV1READ</code>が39.24ポイント上昇するという関係があることになります<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>。 <code>intsvy</code>を使うと，回帰係数にも標準誤差を算出してくれます。 標準誤差の解釈は，平均値の標準誤差とほぼ同様で 「母集団で<code>PV1READ</code>を従属変数・<code>ESCS</code>を独立変数とする回帰分析を行った場合， ESCSの係数は39.24±3.69のどこかにある」（と信じよう） という意味になります<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>。</p>
<p>PVを使う場合は，以下のようになります。 PVの書き方は，<code>pisa.mean.pv</code>の場合と同じです。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>intsvy<span class="sc">::</span><span class="fu">pisa.reg.pv</span>(</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="st">"ESCS"</span>, <span class="at">pvlabel =</span> <span class="fu">paste0</span>(<span class="st">"PV"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="st">"READ"</span>), <span class="at">data =</span> jpn2012</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            Estimate Std. Error t value
(Intercept)   543.59       3.34  162.58
ESCS           37.99       3.91    9.71
R-squared       0.08       0.01    5.42</code></pre>
</div>
</div>
<p>出力の読み方は，先ほどとほぼ同じです。 PV1からPV5までを考慮すると， <code>ESCS</code>が1単位上昇すると読解リテラシーが37.99ポイント上昇するという関係があることになります。 標準誤差もPV1のみの場合は3.69だったのに対し，PV1からPV5を使うと3.91になっています。 <a href="./pvs.html#推算値の使い方">推算値の使い方</a>でも説明しましたが， 一般的な傾向として，PVをすべて使うと，PVが1つの場合に比べて標準誤差が大きくなります。</p>
<p><code>pisa.reg</code>関数・<code>pisa.reg.pv</code>関数のいずれについても，重回帰分析を行うことも可能です。 重回帰分析を行う場合は，引数<code>x</code>に独立変数（仮にA・B・Cとします）を <code>c("A", "B", "C")</code>の形で指定します。 ここでは，<code>pisa.reg.pv</code>関数で読解リテラシーを従属変数， 性別（<code>ST04Q01</code>）とESCS（<code>ESCS</code>）を独立変数とした場合の重回帰分析の例を示します。 式で言うと，<span class="math inline">\(読解リテラシー = \beta_0 + \beta_1 性別 + \beta_2 ESCS + \epsilon\)</span>という状態です。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>intsvy<span class="sc">::</span><span class="fu">pisa.reg.pv</span>(</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">c</span>(<span class="st">"ST04Q01"</span>, <span class="st">"ESCS"</span>), <span class="at">pvlabel =</span> <span class="fu">paste0</span>(<span class="st">"PV"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="st">"READ"</span>), <span class="at">data =</span> jpn2012</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            Estimate Std. Error t value
(Intercept)   577.85       5.10  113.30
ST04Q01       -22.53       3.54   -6.36
ESCS           38.00       3.94    9.65
R-squared       0.09       0.01    6.51</code></pre>
</div>
</div>
<p>出力の読み方は，<code>pisa.reg</code>関数と同じです。 この場合，「性別（<code>ST04Q01</code>）が同じ集団で比べると， <code>ESCS</code>が1単位上昇すると読解リテラシーが38.00上昇する」という関係があることになります<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>。</p>
</section>
<section id="相関係数pvを使う場合" class="level2" data-number="12.5">
<h2 data-number="12.5" class="anchored" data-anchor-id="相関係数pvを使う場合"><span class="header-section-number">12.5</span> 相関係数（PVを使う場合）</h2>
<p>2025年1月時点では，intsvyでPVを使った場合の相関係数は計算できません。 理由は不明ですが，<code>pisa.rho.pv</code>関数が実装されていないからです。 PV1からPV5を使って相関係数を算出する場合は， <code>pisa.rho</code>関数を使って自分で推定値を計算する必要があります。 たとえば，読解リテラシー（PV1READからPV5READ）とESCSの相関係数が計算したい場合は， 次のように入力し，<code>ESCS Rho</code>の列の出力を見る必要があります。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>intsvy<span class="sc">::</span><span class="fu">pisa.rho</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"PV1READ"</span>, <span class="st">"PV2READ"</span>, <span class="st">"PV3READ"</span>, <span class="st">"PV4READ"</span>, <span class="st">"PV5READ"</span>, <span class="st">"ESCS"</span>),</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> jpn2012</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        PV1READ Rho PV1READ s.e. PV2READ Rho PV2READ s.e. PV3READ Rho
PV1READ       1.000        0.000       0.885        0.005       0.887
PV2READ       0.885        0.005       1.000        0.000       0.883
PV3READ       0.887        0.005       0.883        0.005       1.000
PV4READ       0.888        0.005       0.883        0.005       0.884
PV5READ       0.886        0.005       0.882        0.005       0.885
ESCS          0.289        0.024       0.273        0.024       0.277
        PV3READ s.e. PV4READ Rho PV4READ s.e. PV5READ Rho PV5READ s.e. ESCS Rho
PV1READ        0.005       0.888        0.005       0.886        0.005    0.289
PV2READ        0.005       0.883        0.005       0.882        0.005    0.273
PV3READ        0.000       0.884        0.005       0.885        0.006    0.277
PV4READ        0.005       1.000        0.000       0.883        0.005    0.279
PV5READ        0.006       0.883        0.005       1.000        0.000    0.284
ESCS           0.026       0.279        0.025       0.284        0.025    1.000
        ESCS s.e.
PV1READ     0.024
PV2READ     0.024
PV3READ     0.026
PV4READ     0.025
PV5READ     0.025
ESCS        0.000
attr(,"class")
[1] "intsvy.rho" "matrix"     "array"     </code></pre>
</div>
</div>
<p><code>ESCS Rho</code>の列を見ると，PV1READからPV5READとESCSの相関係数が出力されています。 この5つの値をRubinのルールに従って平均したものが読解リテラシーとESCSの相関係数になります<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>。 同様に，<code>ESCS s.e.</code>の列を使えば，相関係数の標準誤差を算出することも可能です。</p>


</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>筆者のgithubです。PISAやTIMSSの日本のデータセットを置いています。<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>興味のある方は，回帰係数の検定／R2乗値について調べてみてください。<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>回帰分析については，<a href="./stat_basics.html#単回帰分析">単回帰分析</a>をご覧ください。<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>標準誤差の解釈については，<a href="./sampling_basic2.html#標準誤差">標準誤差</a>をご覧ください。<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>重回帰分析の解釈については，<a href="./stat_basics.html#重回帰分析">重回帰分析</a>をご覧ください。<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>Rubinのルールについては，<a href="./pvs.html#推算値の使い方">推算値の使い方</a>をご覧ください。<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "コピーしました");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "コピーしました");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/kawa5902\.github\.io\/RforLSA");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./pvs.html" class="pagination-link" aria-label="推算値法">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">推算値法</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./pisa_timss.html" class="pagination-link" aria-label="PISAとTIMSSの概要">
        <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">PISAとTIMSSの概要</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Built with <a href="https://quarto.org/" target="_blank">Quarto</a></p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>